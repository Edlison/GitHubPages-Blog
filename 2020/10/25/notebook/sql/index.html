<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>notebook/sql | Edlison</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="数据库笔记以下Mysql为例 数据库完整性实体完整性实体完整性即主码，用PRIMARY KEY定义.  列级约束：只能应用于一列上。 表级约束：可以应用于表的多个列上。  简而言之，如果完整性约束涉及到该表的多个属性列，必须定义在表级上，否则既可以定义在列级也可以定义在表级。 参照完整性参照完整性即外码，用FOREIGN KEY (列名) REFERENCES &lt;表名&gt;(列名)定义.">
<meta property="og:type" content="article">
<meta property="og:title" content="notebook&#x2F;sql">
<meta property="og:url" content="http://edlison.com/2020/10/25/notebook/sql/index.html">
<meta property="og:site_name" content="Edlison">
<meta property="og:description" content="数据库笔记以下Mysql为例 数据库完整性实体完整性实体完整性即主码，用PRIMARY KEY定义.  列级约束：只能应用于一列上。 表级约束：可以应用于表的多个列上。  简而言之，如果完整性约束涉及到该表的多个属性列，必须定义在表级上，否则既可以定义在列级也可以定义在表级。 参照完整性参照完整性即外码，用FOREIGN KEY (列名) REFERENCES &lt;表名&gt;(列名)定义.">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-10-25T03:43:43.946Z">
<meta property="article:modified_time" content="2020-10-26T14:05:45.038Z">
<meta property="article:author" content="Bolin Shen">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Edlison" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Edlison</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">coding...</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://edlison.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-notebook/sql" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/25/notebook/sql/" class="article-date">
  <time datetime="2020-10-25T03:43:43.946Z" itemprop="datePublished">2020-10-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      notebook/sql
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="数据库笔记"><a href="#数据库笔记" class="headerlink" title="数据库笔记"></a>数据库笔记</h1><p>以下Mysql为例</p>
<h2 id="数据库完整性"><a href="#数据库完整性" class="headerlink" title="数据库完整性"></a>数据库完整性</h2><h3 id="实体完整性"><a href="#实体完整性" class="headerlink" title="实体完整性"></a>实体完整性</h3><p>实体完整性即主码，用<code>PRIMARY KEY</code>定义.</p>
<ul>
<li>列级约束：只能应用于一列上。</li>
<li>表级约束：可以应用于表的多个列上。</li>
</ul>
<p>简而言之，如果完整性约束涉及到该表的多个属性列，必须定义在表级上，否则既可以定义在列级也可以定义在表级。</p>
<h3 id="参照完整性"><a href="#参照完整性" class="headerlink" title="参照完整性"></a>参照完整性</h3><p>参照完整性即外码，用<code>FOREIGN KEY (列名) REFERENCES &lt;表名&gt;(列名)</code>定义.</p>
<p>用constraint指定约束名，约束不指定名称时，系统会给定一个名称。</p>
<p><strong>注意</strong>：外码一定参照主码（可以是其他表的主码，也可以时自己的）,而且外码的列数一定要等于被参照表的主码列数。</p>
<p><strong>违约处理</strong>：对被参照表进行<code>update</code>/<code>delete</code>/<code>insert</code>操作时会破坏参照完整性时，参照表需要告诉被参照表听改怎么做。需要对参照表定义外码时添加<code>on delete</code>/<code>on update[&lt;no action&gt;/&lt;cascade&gt;]</code></p>
<ul>
<li>CASCADE:在父表（被参照表）上update/delete记录时，同步子表（参照表）的匹配记录。</li>
<li>SET NULL:在父表（被参照表）上update/delete记录时，将子表（参照表）上匹配的列设为null（子表的外键列不能为not null）。</li>
<li>NO ACTION:如果子表中有匹配的记录，不允许对父表进行操作。</li>
<li>RESTRICT:同NO ACTION，立即检查外键约束。</li>
</ul>
<p>NULL、RESTRICT、NO ACTION<br>删除：从表记录不存在时，主表才可以删除。删除从表，主表不变<br>更新：从表记录不存在时，主表才可以更新。更新从表，主表不变(无法更新从表)</p>
<p>CASCADE<br>删除：删除主表时自动删除从表。删除从表，主表不变<br>更新：更新主表时自动更新从表。更新从表，主表不变(无法更新从表)</p>
<p>SET NULL<br>删除：删除主表时自动更新从表值为NULL。删除从表，主表不变<br>更新：更新主表时自动更新从表值为NULL。更新从表，主表不变</p>
<p>总结：CASCADE对主表操作 主表影响子表.<br>RESTRICT对主表操作 子表限制主表.<br>Mysql中均无法更新子表.</p>
<h3 id="用户定义完整性"><a href="#用户定义完整性" class="headerlink" title="用户定义完整性"></a>用户定义完整性</h3><p>列值非空（not null），列值唯一（unique），列值需要满足条件表达式（check）.</p>
<ul>
<li>not null:列值不能为空，（列级完整性约束）</li>
<li>unique:列值唯一，（列级或表级约束）</li>
<li>check:列值应该满足的条件，（列级或表级约束）</li>
</ul>
<table>
<thead>
<tr>
<th>a</th>
<th>b</th>
</tr>
</thead>
<tbody><tr>
<td>属性</td>
<td>列级</td>
</tr>
<tr>
<td>元组</td>
<td>表级</td>
</tr>
</tbody></table>
<h3 id="完整性约束命名子句"><a href="#完整性约束命名子句" class="headerlink" title="完整性约束命名子句"></a>完整性约束命名子句</h3><p>完整性约束命名子句是用来给完整性约束命名，这样我们就可以通过该名称对完整性约束进行删除、增加操作。</p>
<h2 id="数据定义"><a href="#数据定义" class="headerlink" title="数据定义"></a>数据定义</h2><h3 id="索引类型"><a href="#索引类型" class="headerlink" title="索引类型"></a>索引类型</h3><table>
<thead>
<tr>
<th>类型</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>普通索引</td>
<td>是最基本的索引，它没有任何限制。</td>
</tr>
<tr>
<td>唯一索引</td>
<td>索引列的值必须唯一，但允许有空值。</td>
</tr>
<tr>
<td>主键索引</td>
<td>是一种特殊的唯一索引，一个表只能有一个主键，不允许有空值。</td>
</tr>
<tr>
<td>组合索引</td>
<td>指多个字段上创建的索引，只有在查询条件中使用了创建索引时的第一个字段，索引才会被使用。</td>
</tr>
<tr>
<td>全文索引</td>
<td>主要用来查找文本中的关键字，而不是直接与索引中的值相比较。fulltext索引配合match against操作使用，而不是一般的where语句加like。</td>
</tr>
</tbody></table>
<h3 id="索引方法"><a href="#索引方法" class="headerlink" title="索引方法"></a>索引方法</h3><table>
<thead>
<tr>
<th>类型</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>BTREE</td>
<td>BTree索引是最常用的mysql数据库索引算法，因为它不仅可以被用在=,&gt;,&gt;=,&lt;,&lt;=和between这些比较操作符上，而且还可以用于like操作符，只要它的查询条件是一个不以通配符开头的常量</td>
</tr>
<tr>
<td>HASH</td>
<td>Hash索引只能用于对等比较，例如=,&lt;=&gt;（相当于=）操作符。由于是一次定位数据，不像BTree索引需要从根节点到枝节点，最后才能访问到页节点这样多次IO访问，所以检索效率远高于BTree索引。</td>
</tr>
</tbody></table>
<h2 id="数据查询"><a href="#数据查询" class="headerlink" title="数据查询"></a>数据查询</h2><h3 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h3><ol>
<li>等值与非等值连接查询</li>
</ol>
<p>=为等值连接，连接字段必须为可比的。</p>
<ol start="2">
<li>自身连接</li>
</ol>
<p>自己对自己相连，比如要查询先修课的先修课，要对自己查询两次。</p>
<ol start="3">
<li>外连接</li>
</ol>
<p><code>LEFT JOIN</code> 保存左侧所有元组，右侧不存在的用<code>NULL</code>补齐.(Mysql中<code>LEFT JOIN</code>与<code>LEFT OUTER JOIN</code>相同)</p>
<ol start="4">
<li>多表连接</li>
</ol>
<p>跨多个表进行连接查询。</p>
<ol start="5">
<li>*交叉连接</li>
</ol>
<p>笛卡尔积。<br><code>SELECT * FROM &lt;TABLE1&gt;, &lt;TABLE2&gt;</code>或<code>SELECT * FROM &lt;TABLE1&gt; CROSS JOIN &lt;TABLE2&gt;</code></p>
<ol start="6">
<li>*内连接</li>
</ol>
<p><strong>如果没有连接条件，INNER JOIN 和 CROSS JOIN 在语法上是等同的，两者可以互换。</strong></p>
<p><code>SELECT &lt;字段名&gt; FROM &lt;表1&gt; INNER JOIN &lt;表2&gt; [ON子句]</code></p>
<h3 id="嵌套查询"><a href="#嵌套查询" class="headerlink" title="嵌套查询"></a>嵌套查询</h3><ol>
<li>不相关子查询</li>
</ol>
<p>子查询的查询条件不依赖于父查询。<br>有些嵌套查询可以使用连接运算替代，有些不可以。</p>
<ol start="2">
<li>相关子查询</li>
</ol>
<p>子查询的条件依赖于父查询。<br><code>SELECT Sno, Cno FROM SC x WHERE Grade &gt;= (SELECT AVG(Grade) FROM SC y WHERE y.Sno = x.Sno)</code></p>
<ol start="3">
<li>带有ANY(SOME)或ALL谓词的子查询</li>
</ol>
<p>子查询返回单值用比较运算符，返回多值时需要用ANY(SOME)或ALL谓词修饰符。且使用ANY或ALL时需要同时使用比较运算符。</p>
<ol start="4">
<li>带有EXISTS谓词的子查询</li>
</ol>
<p>子查询不返回任何数据，只产生逻辑真值<code>true</code>或<code>false</code>。</p>
<p><strong>注意</strong>：全称量词可以通过否运算转换成存在量词。<br><strong>注意</strong>：蕴含式可以转换为析取式。</p>
<ol start="5">
<li>集合查询</li>
</ol>
<p>并操作<code>UNION</code>,交操作<code>INTERSECT</code>,差操作<code>EXCEPT</code>.</p>
<ol start="6">
<li>派生表查询</li>
</ol>
<p>子查询出现在FROM子句中时，这是子查询生成临时的派生表。</p>
<p><strong>注意</strong>：必须为派生关系指定一个别名。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://edlison.com/2020/10/25/notebook/sql/" data-id="ckgqm78xs00001moj3lj7dzt2" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/11/06/paper/ClusteringGANSiamese/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          paper/ClusteringGANSiamese
        
      </div>
    </a>
  
  
    <a href="/2020/09/23/nlp/BERT/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">nlp/BERT</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/11/07/notebook/linux-path/">notebook/linux-path</a>
          </li>
        
          <li>
            <a href="/2020/11/07/notebook/jupyter-kernel/">notebook/jupyter-kernel</a>
          </li>
        
          <li>
            <a href="/2020/11/06/paper/ClusteringGANSiamese/">paper/ClusteringGANSiamese</a>
          </li>
        
          <li>
            <a href="/2020/10/25/notebook/sql/">notebook/sql</a>
          </li>
        
          <li>
            <a href="/2020/09/23/nlp/BERT/">nlp/BERT</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Bolin Shen<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>